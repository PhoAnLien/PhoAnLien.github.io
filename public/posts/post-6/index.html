<!DOCTYPE html>
<html lang="vi-VN">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>6. Java NIO: Lập trình mạng hiệu năng cao với Non-blocking I/O | Blog của Thành</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <meta name="generator" content="Hugo 0.153.2">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
<link rel="stylesheet" href="/ananke/css/main.min.css" >



  
    <link rel="stylesheet" href="/css/custom.css">
  



  
  <link rel="stylesheet" href="/css/custom.css?v=1767079028951051900">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head><body class="ma0 avenir bg-near-white">
  


  
  
  
  <header class="cover bg-center" style="background-image: url('https://source.unsplash.com/random/800x600/?server,performance');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Blog của Thành
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/" title="Trang chủ page">
              Trang chủ
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/posts/" title="Danh sách bài viết page">
              Danh sách bài viết
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/about/" title="Giới thiệu &amp; Profile page">
              Giới thiệu &amp; Profile
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">6. Java NIO: Lập trình mạng hiệu năng cao với Non-blocking I/O</div>
          
        
      </div>
    </div>
  </header>




  <main class="pb7" role="main">
    



<article class="flex-l mw8 center ph3 flex-wrap justify-between animate-fade-in-up mt4">
    <header class="w-100 mb5">
        <div class="flex items-center mb3">
            <img src="/images/avatar.jpg" class="br-100 h3 w3 dib ba b--black-10 pa1 shadow-soft mr3"
                style="object-fit: cover;">
            <div>
                <div class="f6 ttu tracked text-primary b">posts</div>
                
                <time class="f7 gray">25/12/2024</time>
                
            </div>
        </div>

        


        <h1 class="f1 athelas mt0 mb3 dark-blue">6. Java NIO: Lập trình mạng hiệu năng cao với Non-blocking I/O</h1><div id="sharing" class="mt3 ananke-socials"></div>
</header>

    <div class="nested-copy-line-height lh-copy f4 nested-links mid-gray w-100 w-70-l pr4-l">
        <div class="post-content"><p>Trong các bài trước, chúng ta đã dùng <code>java.io</code> (Blocking I/O). Nhược điểm lớn nhất của nó là mỗi Client kết nối cần một Thread riêng biệt. Khi số lượng Client lên tới hàng ngàn, Server sẽ bị quá tải bộ nhớ. <code>Java NIO</code> (New I/O) ra đời để giải quyết vấn đề này.</p>
<h2 id="1-ba-thành-phần-cốt-lõi-của-nio">1. Ba thành phần cốt lõi của NIO</h2>
<h3 id="channel-kênh">Channel (Kênh)</h3>
<p>Giống như &ldquo;đường ống&rdquo; trong IO truyền thống, nhưng Channel có thể đọc và ghi hai chiều (bi-directional) và hỗ trợ thao tác bất đồng bộ.</p>
<ul>
<li><code>SocketChannel</code>: Dùng cho TCP Client.</li>
<li><code>ServerSocketChannel</code>: Dùng cho TCP Server.</li>
<li><code>DatagramChannel</code>: Dùng cho UDP.</li>
</ul>
<h3 id="buffer-bộ-đệm">Buffer (Bộ đệm)</h3>
<p>Trong NIO, dữ liệu luôn được đọc vào hoặc ghi từ một <code>Buffer</code>. Nó giống như một khay chứa dữ liệu tạm thời.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Tạo buffer với dung lượng 1024 byte</span>
</span></span><span style="display:flex;"><span>ByteBuffer buffer <span style="color:#f92672">=</span> ByteBuffer.<span style="color:#a6e22e">allocate</span>(1024);
</span></span></code></pre></div><h3 id="selector-bộ-chọn">Selector (Bộ chọn)</h3>
<p>Đây là &ldquo;vũ khí bí mật&rdquo; của NIO. Một Selector có thể giám sát nhiều Channel cùng lúc. Nó cho phép <strong>một Thread duy nhất</strong> xử lý hàng ngàn kết nối.</p>
<h2 id="2-mô-hình-hoạt-động-của-selector">2. Mô hình hoạt động của Selector</h2>
<p>Thay vì chặn (block) chờ dữ liệu, Selector sẽ hỏi: <em>&ldquo;Có Channel nào đang sẵn sàng để đọc/ghi không?&rdquo;</em>.</p>
<ol>
<li>Đăng ký các Channel vào Selector với sự kiện quan tâm (<code>OP_ACCEPT</code>, <code>OP_READ</code>, &hellip;).</li>
<li>Selector chạy vòng lặp vô tận, chờ sự kiện xảy ra.</li>
<li>Khi có sự kiện, Selector trả về danh sách các <code>SelectionKey</code>.</li>
<li>Xử lý dữ liệu và quay lại chờ đợi.</li>
</ol>
<h2 id="3-ví-dụ-nio-server-đơn-giản">3. Ví dụ: NIO Server đơn giản</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.InetSocketAddress;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.nio.ByteBuffer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.nio.channels.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Iterator;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NioServer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 1. Mở Selector</span>
</span></span><span style="display:flex;"><span>        Selector selector <span style="color:#f92672">=</span> Selector.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 2. Mở ServerSocketChannel và lắng nghe cổng 5000</span>
</span></span><span style="display:flex;"><span>        ServerSocketChannel serverSocket <span style="color:#f92672">=</span> ServerSocketChannel.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>        serverSocket.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">new</span> InetSocketAddress(5000));
</span></span><span style="display:flex;"><span>        serverSocket.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>); <span style="color:#75715e">// Quan trọng: Chế độ Non-blocking</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 3. Đăng ký nhận sự kiện kết nối mới (Accept)</span>
</span></span><span style="display:flex;"><span>        serverSocket.<span style="color:#a6e22e">register</span>(selector, SelectionKey.<span style="color:#a6e22e">OP_ACCEPT</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;NIO Server started on port 5000...&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Chờ sự kiện (Block cho đến khi có ít nhất 1 channel sẵn sàng)</span>
</span></span><span style="display:flex;"><span>            selector.<span style="color:#a6e22e">select</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Lấy danh sách các key đã sẵn sàng</span>
</span></span><span style="display:flex;"><span>            Set<span style="color:#f92672">&lt;</span>SelectionKey<span style="color:#f92672">&gt;</span> selectedKeys <span style="color:#f92672">=</span> selector.<span style="color:#a6e22e">selectedKeys</span>();
</span></span><span style="display:flex;"><span>            Iterator<span style="color:#f92672">&lt;</span>SelectionKey<span style="color:#f92672">&gt;</span> iter <span style="color:#f92672">=</span> selectedKeys.<span style="color:#a6e22e">iterator</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (iter.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                SelectionKey key <span style="color:#f92672">=</span> iter.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (key.<span style="color:#a6e22e">isAcceptable</span>()) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Xử lý kết nối mới</span>
</span></span><span style="display:flex;"><span>                    SocketChannel client <span style="color:#f92672">=</span> serverSocket.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>                    client.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>                    client.<span style="color:#a6e22e">register</span>(selector, SelectionKey.<span style="color:#a6e22e">OP_READ</span>);
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;New connection: &#34;</span> <span style="color:#f92672">+</span> client.<span style="color:#a6e22e">getRemoteAddress</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (key.<span style="color:#a6e22e">isReadable</span>()) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Xử lý đọc dữ liệu</span>
</span></span><span style="display:flex;"><span>                    SocketChannel client <span style="color:#f92672">=</span> (SocketChannel) key.<span style="color:#a6e22e">channel</span>();
</span></span><span style="display:flex;"><span>                    ByteBuffer buffer <span style="color:#f92672">=</span> ByteBuffer.<span style="color:#a6e22e">allocate</span>(256);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">int</span> bytesRead <span style="color:#f92672">=</span> client.<span style="color:#a6e22e">read</span>(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (bytesRead <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>                        client.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                        String msg <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String(buffer.<span style="color:#a6e22e">array</span>()).<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>                        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Received: &#34;</span> <span style="color:#f92672">+</span> msg);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                iter.<span style="color:#a6e22e">remove</span>(); <span style="color:#75715e">// Xóa key đã xử lý</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="4-tại-sao-nio-nhanh-hơn">4. Tại sao NIO nhanh hơn?</h2>
<p>NIO cho phép xử lý I/O không chặn dòng thực thi (Non-blocking). Nó giúp tiết kiệm tài nguyên hệ thống (ít Thread hơn) và giảm chi phí chuyển ngữ cảnh (Context Switching), đặc biệt hiệu quả cho các ứng dụng chat, server game hoặc các hệ thống thời gian thực tải cao.</p>
</div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/java/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Java</a>
   </li>
  
   <li class="list di">
     <a href="/tags/nio/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">NIO</a>
   </li>
  
   <li class="list di">
     <a href="/tags/network/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Network</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
            
        </div>
    </div>

    
    <aside class="w-100 w-30-l mt4 mt0-l">

        <div class="mt4 tc">
            <a href="/posts/" class="f7 link gray hover-blue b ttu tracked">&larr; Quay lại danh sách</a>
        </div>
    </aside>
</article>

  </main>

  <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="http://localhost:1313/" >
    &copy;  © 2025 Bản quyền thuộc về Thành Phạm 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  

</body>

</html>